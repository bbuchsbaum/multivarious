<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Linear Re-representation with regress() • multivarious</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linear Re-representation with regress()">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multivarious</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Classifier.html">Classifying in latent space: k-NN &amp; Random-Forest wrappers</a></li>
    <li><a class="dropdown-item" href="../articles/Composing_Projectors.html">Composing Projectors: Chaining Models</a></li>
    <li><a class="dropdown-item" href="../articles/CPCAplus.html">Contrastive PCA: Finding What's Different Between Groups</a></li>
    <li><a class="dropdown-item" href="../articles/CrossValidation.html">Cross-validation for Dimensionality Reduction</a></li>
    <li><a class="dropdown-item" href="../articles/Extending.html">Extending multiblock: CCA and glmnet Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction.html">Introduction to the multivarious Package</a></li>
    <li><a class="dropdown-item" href="../articles/Multiblock.html">Multiblock basics: one projector, many tables</a></li>
    <li><a class="dropdown-item" href="../articles/Nystrom.html">Kernel PCA Made Fast: The Nyström Approximation</a></li>
    <li><a class="dropdown-item" href="../articles/Partial_Projection.html">Partial projection: working with incomplete feature sets</a></li>
    <li><a class="dropdown-item" href="../articles/PermutationTesting.html">Permutation Testing in multivarious</a></li>
    <li><a class="dropdown-item" href="../articles/PreProcessing.html">Pre-processing pipelines in multiblock</a></li>
    <li><a class="dropdown-item" href="../articles/Regress.html">Linear Re-representation with regress()</a></li>
    <li><a class="dropdown-item" href="../articles/SVD_PCA.html">SVD wrapper, PCA and the bi_projector</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Linear Re-representation with regress()</h1>
            
      

      <div class="d-none name"><code>Regress.Rmd</code></div>
    </div>

    
    
<p>When you already have a known set of basis functions—such as Fourier
components, wavelets, splines, or principal components from a reference
dataset—the goal isn’t to discover a latent space, but rather to express
new data in terms of that existing basis. The <code><a href="../reference/regress.html">regress()</a></code>
function facilitates this by wrapping several multi-output linear models
within the <code>bi_projector</code> API.</p>
<p>This integration means you automatically inherit standard
<code>bi_projector</code> methods for tasks like:</p>
<ul>
<li>
<code><a href="../reference/project.html">project()</a></code>: Map new data from the original space into
the basis coefficients.</li>
<li>
<code><a href="../reference/inverse_projection.html">inverse_projection()</a></code>: Map basis coefficients back to
the original data space.</li>
<li>
<code><a href="../reference/reconstruct.html">reconstruct()</a></code> / <code><a href="../reference/reconstruct_new.html">reconstruct_new()</a></code>:
Reconstruct data using all or a subset of basis components.</li>
<li>
<code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>: Retrieve the basis coefficients.</li>
<li>
<code><a href="../reference/truncate.html">truncate()</a></code>: Keep only a subset of basis
components.</li>
<li>Plus caching, variable tracking helpers, etc.</li>
</ul>
<p>This vignette demonstrates a typical workflow using an orthonormal
Fourier basis, but the <code><a href="../reference/regress.html">regress()</a></code> function works equally
well with arbitrary, potentially non-orthogonal, basis dictionaries.</p>
<hr>
<div class="section level2">
<h2 id="build-a-design-matrix-of-basis-functions">1. Build a design matrix of basis functions<a class="anchor" aria-label="anchor" href="#build-a-design-matrix-of-basis-functions"></a>
</h2>
<p>First, let’s define our basis. We’ll use sines and cosines.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">128</span>                       <span class="co"># Number of observations (e.g., signals)</span></span>
<span><span class="va">p</span>  <span class="op">&lt;-</span> <span class="fl">32</span>                        <span class="co"># Original variables per observation (e.g., time points)</span></span>
<span><span class="va">k</span>  <span class="op">&lt;-</span> <span class="fl">20</span>                        <span class="co"># Number of basis functions (&lt;= p often, &lt;= n for lm)</span></span>
<span></span>
<span><span class="co">## Create toy data: smooth signals + noise</span></span>
<span><span class="va">t</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">Y</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n</span>,  <span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">3</span><span class="op">*</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">5</span><span class="op">*</span><span class="va">t</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span> </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>, <span class="va">p</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># Note: Y is p x n here</span></span>
<span></span>
<span><span class="co">## Orthonormal Fourier basis (columns = basis functions)</span></span>
<span><span class="co"># We create k/2 sine and k/2 cosine terms, plus an intercept</span></span>
<span><span class="va">freqs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">k</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Integer division for number of frequencies</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">p</span><span class="op">)</span>, <span class="co"># Intercept column</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">freqs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">f</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">freqs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">f</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sin"</span>, <span class="va">freqs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cos"</span>, <span class="va">freqs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make columns orthonormal (length 1, orthogonal to each other)</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">B</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">B</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Dimensions: Y is"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, <span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, </span>
<span>          <span class="st">", Basis B is"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>, <span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dimensions: Y is 32 x 128 , Basis B is 32 x 21</span></span>
<span><span class="co"># We want coefficients C (k x n) such that Y ≈ B %*% C.</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="fit-multi-output-regression">2. Fit multi-output regression<a class="anchor" aria-label="anchor" href="#fit-multi-output-regression"></a>
</h2>
<p>Now, we use <code><a href="../reference/regress.html">regress()</a></code> to find the coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
that best represent each signal in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
using the basis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bbuchsbaum.github.io/multivarious/">multivarious</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit using standard linear models (lm)</span></span>
<span><span class="co"># Y is p x n (32 x 128): 32 time points x 128 signals</span></span>
<span><span class="co"># B is p x k (32 x 21): 32 time points x 21 basis functions</span></span>
<span><span class="co"># regress will fit 128 separate regressions, each with 32 observations and 21 predictors</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regress.html">regress</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">B</span>,          <span class="co"># Predictors = basis functions (p x k)</span></span>
<span>               Y <span class="op">=</span> <span class="va">Y</span>,          <span class="co"># Response = signals (p x n)</span></span>
<span>               method    <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>               intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># Basis B already includes an intercept column</span></span>
<span></span>
<span><span class="co"># The result is a bi_projector object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Regression bi_projector object:</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span><span style="color: #BBBB00;">  Method: </span><span style="color: #00BBBB;">lm</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">  Input dimension: </span>128</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">  Output dimension: </span>21</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">  Coefficients dimension: </span> 128 x 21</span></span>
<span></span>
<span><span class="co">## Conceptual mapping to bi_projector slots:</span></span>
<span><span class="co"># fit$v : Coefficients (n x k) - Basis coefficients for each signal.</span></span>
<span><span class="co"># fit$s : Design Matrix (p x k) - The basis matrix B.</span></span>
<span><span class="co">#         Stored for reconstruction.</span></span></code></pre></div>
<p>The <code>bi_projector</code> structure provides a consistent way to
access the core components: the basis (<code>fit$s</code>) and the
coefficients (<code>fit$v</code>).</p>
<hr>
</div>
<div class="section level2">
<h2 id="go-back-and-forth-between-spaces">3. Go back and forth between spaces<a class="anchor" aria-label="anchor" href="#go-back-and-forth-between-spaces"></a>
</h2>
<p>With the fitted <code>bi_projector</code>, projecting and
reconstructing is straightforward.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get the coefficients for the first 3 signals</span></span>
<span><span class="va">coef_matrix_first3</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">v</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span> <span class="co"># 3 x k matrix (first 3 signals x basis functions)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Coefficients for signal 1:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coefficients for signal 1:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">coef_matrix_first3</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Intercept         sin1         sin2         sin3         sin4         sin5 </span></span>
<span><span class="co">#&gt;  0.135054901  0.587137215 -0.183816033 12.150464524 -0.007984793 -0.162281276 </span></span>
<span><span class="co">#&gt;         sin6         sin7         sin8         sin9        sin10         cos1 </span></span>
<span><span class="co">#&gt; -0.593723657  0.581637564 -0.370023776 -0.108499186  0.173654284  0.394261726 </span></span>
<span><span class="co">#&gt;         cos2         cos3         cos4         cos5         cos6         cos7 </span></span>
<span><span class="co">#&gt; -0.590122835  0.288835048  0.448031764  8.196393043  0.080690010 -0.612238653 </span></span>
<span><span class="co">#&gt;         cos8         cos9        cos10 </span></span>
<span><span class="co">#&gt;  0.678547189 -0.030446715  0.088104811</span></span>
<span></span>
<span><span class="co">## Reconstruct the original fitted data</span></span>
<span><span class="co"># The bi_projector stores: s (design matrix B) and v (coefficients)</span></span>
<span><span class="co"># Reconstruction: Y_hat = s %*% t(v) = B %*% t(coefficients)</span></span>
<span><span class="va">Y_hat</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">s</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">v</span><span class="op">)</span> <span class="co"># Returns p x n matrix (same shape as Y)</span></span>
<span><span class="va">max_reconstruction_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">Y_hat</span> <span class="op">-</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMaximum reconstruction error for fitted data:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">max_reconstruction_error</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Maximum reconstruction error for fitted data: 0.7</span></span>
<span><span class="co"># Note: With noise and limited basis functions, error won't be exactly zero</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"This error is acceptable given the noise and basis limitations.\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; This error is acceptable given the noise and basis limitations.</span></span>
<span></span>
<span><span class="co">## Project a *new* signal onto the basis</span></span>
<span><span class="co"># Create a new signal (using the same underlying pattern + noise)</span></span>
<span><span class="va">Y_new_signal</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">3</span><span class="op">*</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">5</span><span class="op">*</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span>, sd<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">Y_new_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">Y_new_signal</span>, nrow <span class="op">=</span> <span class="va">p</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For an orthonormal basis B, projection is simply: coef = t(B) %*% Y_new</span></span>
<span><span class="co"># This finds the coefficients that best represent Y_new in the basis</span></span>
<span><span class="va">coef_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">s</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y_new_matrix</span>  <span class="co"># k x 1 (basis coefficients)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBasis coefficients for new signal:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Basis coefficients for new signal:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">coef_new</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Intercept        sin1        sin2        sin3        sin4        sin5 </span></span>
<span><span class="co">#&gt; -0.16459096  0.35921181 -0.09452109 11.90760497  0.37429968 -0.13899361 </span></span>
<span><span class="co">#&gt;        sin6        sin7        sin8        sin9       sin10        cos1 </span></span>
<span><span class="co">#&gt;  0.44535459 -0.16769033  0.02891241  0.54613517 -0.41145969  0.53832581 </span></span>
<span><span class="co">#&gt;        cos2        cos3        cos4        cos5        cos6        cos7 </span></span>
<span><span class="co">#&gt;  0.45371511  0.24009459  0.81766812  8.25333978  0.75410708 -0.42128770 </span></span>
<span><span class="co">#&gt;        cos8        cos9       cos10 </span></span>
<span><span class="co">#&gt;  0.49377610  0.45618692  0.79379189</span></span>
<span></span>
<span><span class="co"># Reconstruct: Y_recon = B %*% coef</span></span>
<span><span class="va">Y_new_recon</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">s</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">coef_new</span>  <span class="co"># p x 1</span></span>
<span><span class="va">reconstruction_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">Y_new_matrix</span> <span class="op">-</span> <span class="va">Y_new_recon</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nReconstruction RMSE for new signal:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">reconstruction_error</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reconstruction RMSE for new signal: 0.362</span></span>
<span></span>
<span><span class="co"># Note: Because B is orthonormal, projection and reconstruction are exact inverses</span></span>
<span><span class="co"># The reconstruction error comes from the noise in the signal and limited basis functions</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="regularisation-pls">4. Regularisation &amp; PLS<a class="anchor" aria-label="anchor" href="#regularisation-pls"></a>
</h2>
<p>If the basis is ill-conditioned or you need feature
selection/shrinkage, simply change the <code>method</code> argument.
<code><a href="../reference/regress.html">regress()</a></code> wraps common regularized models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ridge regression (requires glmnet)</span></span>
<span><span class="va">fit_ridge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regress.html">regress</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">B</span>, Y <span class="op">=</span> <span class="va">Y</span>, method <span class="op">=</span> <span class="st">"mridge"</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Elastic Net (requires glmnet)</span></span>
<span><span class="va">fit_enet</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regress.html">regress</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">B</span>, Y <span class="op">=</span> <span class="va">Y</span>, method <span class="op">=</span> <span class="st">"enet"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, lambda <span class="op">=</span> <span class="fl">0.02</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Partial Least Squares (requires pls package) - useful if k &gt; p or multicollinearity</span></span>
<span><span class="va">fit_pls</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regress.html">regress</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">B</span>, Y <span class="op">=</span> <span class="va">Y</span>, method <span class="op">=</span> <span class="st">"pls"</span>, ncomp <span class="op">=</span> <span class="fl">15</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All these return bi_projector objects, so downstream code using </span></span>
<span><span class="co"># project(), reconstruct(), coef() etc. remains the same.</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="partial-custom-mappings">5. Partial / custom mappings<a class="anchor" aria-label="anchor" href="#partial-custom-mappings"></a>
</h2>
<p>The <code>bi_projector</code> interface allows for flexible
manipulation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Truncate: Keep only the first 5 basis functions (Intercept + 2 sine + 2 cosine)</span></span>
<span><span class="va">fit5</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/truncate.html">truncate</a></span><span class="op">(</span><span class="va">fit</span>, ncomp <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dimensions after truncating to 5 components:"</span>, </span>
<span>    <span class="st">"Basis (s):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit5</span><span class="op">$</span><span class="va">s</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"x"</span><span class="op">)</span>, </span>
<span>    <span class="st">", Coefs (v):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit5</span><span class="op">$</span><span class="va">v</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"x"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dimensions after truncating to 5 components: Basis (s): 32x5 , Coefs (v): 128x5</span></span>
<span><span class="co"># Reconstruction using only first 5 basis functions (manual)</span></span>
<span><span class="co"># Equivalent to: scores(fit5) %*% t(coef(fit5)) for the selected components</span></span>
<span><span class="va">Y_hat5</span> <span class="op">&lt;-</span> <span class="va">fit5</span><span class="op">$</span><span class="va">s</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fit5</span><span class="op">$</span><span class="va">v</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Partial inverse projection: Map only a subset of coefficients back</span></span>
<span><span class="co"># e.g., reconstruct using only components 2 through 6 (skip intercept)</span></span>
<span><span class="co"># Note: partial_inverse_projection is not a standard bi_projector method, </span></span>
<span><span class="co"># this might require manual slicing of the basis matrix B (fit$s) or coefs (fit$v).</span></span>
<span><span class="co"># Manual reconstruction example for components 2:6</span></span>
<span><span class="va">coef_subset</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">v</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span>, , drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="co"># k_sub x n</span></span>
<span><span class="va">basis_subset</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">s</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="co"># p x k_sub</span></span>
<span><span class="va">Y_lowHat</span> <span class="op">&lt;-</span> <span class="va">basis_subset</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">coef_subset</span> <span class="co"># p x n reconstruction</span></span>
<span></span>
<span><span class="co"># Variable usage helpers (Conceptual - actual functions might differ)</span></span>
<span><span class="co"># `variables_used(fit)` could show which basis functions have non-zero coefficients (esp. for 'enet').</span></span>
<span><span class="co"># `vars_for_component(fit, k)` isn't directly applicable here as components are the basis functions themselves.</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="under-the-hood-matrix-view">6. Under-the-hood: Matrix View<a class="anchor" aria-label="anchor" href="#under-the-hood-matrix-view"></a>
</h2>
<p>The core idea is to represent the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">p \times n</annotation></semantics></math>
data matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
as a product of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">p \times k</annotation></semantics></math>
basis matrix (stored in <code>s</code>) and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">k \times n</annotation></semantics></math>
coefficient matrix (stored in <code>v</code>):
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><munder><mi>Y</mi><mo accent="true">⏟</mo></munder><mrow><mi>p</mi><mo>×</mo><mi>n</mi></mrow></munder><mo>≈</mo><munder><munder><mi>s</mi><mo accent="true">⏟</mo></munder><mrow><mi>p</mi><mo>×</mo><mi>k</mi></mrow></munder><munder><munder><mi>v</mi><mo accent="true">⏟</mo></munder><mrow><mi>k</mi><mo>×</mo><mi>n</mi></mrow></munder></mrow><annotation encoding="application/x-tex"> \underbrace{Y}_{p\times n} \approx \underbrace{s}_{p\times k} \underbrace{v}_{k\times n} </annotation></semantics></math></p>
<p><code><a href="../reference/regress.html">regress()</a></code> estimates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>v</mi><annotation encoding="application/x-tex">v</annotation></semantics></math>
(coefficients) based on the chosen method:</p>
<table class="table">
<colgroup>
<col width="12%">
<col width="32%">
<col width="27%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th><code>method</code></th>
<th>Solver Used (Conceptual)</th>
<th>Regularisation</th>
<th>Key Reference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>“lm”</td>
<td>QR decomposition (<code>lm.fit</code>)</td>
<td>None</td>
<td>Classical OLS</td>
</tr>
<tr class="even">
<td>“mridge”</td>
<td>
<code>glmnet</code> (alpha=0)</td>
<td>Ridge
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow><mi>β</mi><msubsup><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\lambda ||\beta||_2^2</annotation></semantics></math>)</td>
<td>Hoerl &amp; Kennard 1970</td>
</tr>
<tr class="odd">
<td>“enet”</td>
<td><code>glmnet</code></td>
<td>Elastic Net
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>-mix)</td>
<td>Zou &amp; Hastie 2005</td>
</tr>
<tr class="even">
<td>“pls”</td>
<td><code><a href="https://rdrr.io/pkg/pls/man/mvr.html" class="external-link">pls::plsr</a></code></td>
<td>Latent PLS factors</td>
<td>Wold 1984</td>
</tr>
</tbody>
</table>
<p>The resulting object stores: * <code>v</code>: The estimated
coefficient matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">k \times n</annotation></semantics></math>).
* <code>s</code>: The basis/design matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">p \times k</annotation></semantics></math>),
possibly centered or scaled by the underlying solver. *
<code>sdev</code>, <code>center</code>: Potentially stores
scaling/centering info related to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>.</p>
<p>All other <code>bi_projector</code> methods (<code>project</code>,
<code>reconstruct</code>, <code>inverse_projection</code>) are derived
from these core matrices.</p>
<hr>
</div>
<div class="section level2">
<h2 id="internal-checks-developer-focus">7. Internal Checks (Developer Focus)<a class="anchor" aria-label="anchor" href="#internal-checks-developer-focus"></a>
</h2>
<p>This section contains internal consistency checks, primarily for
package development and CI testing.</p>
<p>The code chunk below only runs if the environment variable
<code>_MULTIVARIOUS_DEV_COVERAGE</code> is set.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This chunk only runs if _MULTIVARIOUS_DEV_COVERAGE is non-empty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Running internal consistency checks for regress()..."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running internal consistency checks for regress()...</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span></span>
<span>    <span class="co"># Check reconstruction fidelity for lm</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="../reference/reconstruct.html">reconstruct</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-10</span>,</span>
<span>    <span class="co"># Check dimensions of inverse projection matrix (n x p)</span></span>
<span>    <span class="co"># inverse_projection maps coefficients (k x n) back to data (p x n)</span></span>
<span>    <span class="co"># The matrix itself maps k -&gt; p implicitly. Let's check coef matrix dims.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">v</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>, <span class="co"># k rows</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">v</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>  <span class="co"># n columns</span></span>
<span>    <span class="co"># Add checks for other methods if evaluated</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Regress internal checks passed."</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Regress internal checks failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in value[[3L]](cond): Regress internal checks failed:</span></span>
<span><span class="co">#&gt; max(abs(reconstruct(fit) - Y)) &lt; 1e-10 is not TRUE</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="take-aways">8. Take-aways<a class="anchor" aria-label="anchor" href="#take-aways"></a>
</h2>
<ul>
<li>
<code><a href="../reference/regress.html">regress()</a></code> provides a convenient way to fit multiple
linear models simultaneously when expressing data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
in a known basis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>.</li>
<li>It returns a <code>bi_projector</code>, giving immediate access to
projection, reconstruction, truncation, and coefficient extraction.</li>
<li>Supports standard OLS (<code>lm</code>), Ridge
(<code>mridge</code>), Elastic Net (<code>enet</code>), and PLS
(<code>pls</code>) out-of-the-box.</li>
<li>Works with any basis dictionary (orthonormal or not).</li>
<li>Can be integrated into larger analysis pipelines using composition
(<code>%&gt;&gt;%</code>) or cross-validation helpers.</li>
</ul>
<p>Happy re-representing!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
