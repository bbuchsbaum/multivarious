<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Contrastive PCA: Finding What's Different Between Groups ‚Ä¢ multivarious</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Contrastive PCA: Finding What's Different Between Groups">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multivarious</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Classifier.html">Classifying in latent space: k-NN &amp; Random-Forest wrappers</a></li>
    <li><a class="dropdown-item" href="../articles/Composing_Projectors.html">Composing Projectors: Chaining Models</a></li>
    <li><a class="dropdown-item" href="../articles/CPCAplus.html">Contrastive PCA: Finding What's Different Between Groups</a></li>
    <li><a class="dropdown-item" href="../articles/CrossValidation.html">Cross-validation for Dimensionality Reduction</a></li>
    <li><a class="dropdown-item" href="../articles/Extending.html">Extending multiblock: CCA and glmnet Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction.html">Introduction to the multivarious Package</a></li>
    <li><a class="dropdown-item" href="../articles/Multiblock.html">Multiblock basics: one projector, many tables</a></li>
    <li><a class="dropdown-item" href="../articles/Nystrom.html">Kernel PCA Made Fast: The Nystr√∂m Approximation</a></li>
    <li><a class="dropdown-item" href="../articles/Partial_Projection.html">Partial projection: working with incomplete feature sets</a></li>
    <li><a class="dropdown-item" href="../articles/PermutationTesting.html">Permutation Testing in multivarious</a></li>
    <li><a class="dropdown-item" href="../articles/PreProcessing.html">Pre-processing pipelines in multiblock</a></li>
    <li><a class="dropdown-item" href="../articles/Regress.html">Linear Re-representation with regress()</a></li>
    <li><a class="dropdown-item" href="../articles/SVD_PCA.html">SVD wrapper, PCA and the bi_projector</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Contrastive PCA: Finding What's Different Between Groups</h1>
            
      

      <div class="d-none name"><code>CPCAplus.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-is-contrastive-pca">What is Contrastive PCA?<a class="anchor" aria-label="anchor" href="#what-is-contrastive-pca"></a>
</h2>
<p>Imagine you‚Äôre studying two groups: patients with a disease and
healthy controls. Both groups show variation in their measurements, but
you‚Äôre specifically interested in what makes the patients
<em>different</em>. Standard PCA would find the largest sources of
variation across all samples, which might be dominated by age, sex, or
other factors common to both groups.</p>
<p><strong>Contrastive PCA (cPCA++) finds patterns that are enriched in
one group (foreground) compared to another (background).</strong></p>
</div>
<div class="section level2">
<h2 id="a-simple-example">A Simple Example<a class="anchor" aria-label="anchor" href="#a-simple-example"></a>
</h2>
<p>Let‚Äôs start with a practical example to see why contrastive PCA is
useful:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">n_features</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># Create background data (e.g., healthy controls)</span></span>
<span><span class="co"># Main variation is in features 1-10</span></span>
<span><span class="va">background</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_samples</span> <span class="op">*</span> <span class="va">n_features</span><span class="op">)</span>, <span class="va">n_samples</span>, <span class="va">n_features</span><span class="op">)</span></span>
<span><span class="va">background</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">background</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op">*</span> <span class="fl">3</span>  <span class="co"># Strong common variation</span></span>
<span></span>
<span><span class="co"># Create foreground data (e.g., patients)</span></span>
<span><span class="co"># Has the same common variation PLUS disease-specific signal in features 20-25</span></span>
<span><span class="va">foreground</span> <span class="op">&lt;-</span> <span class="va">background</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="op">]</span>  <span class="co"># Start with same structure</span></span>
<span><span class="va">foreground</span><span class="op">[</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">foreground</span><span class="op">[</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">60</span>, <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Standard PCA on combined data</span></span>
<span><span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">background</span>, <span class="va">foreground</span><span class="op">)</span></span>
<span><span class="va">regular_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca.html">pca</a></span><span class="op">(</span><span class="va">all_data</span>, ncomp <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Contrastive PCA</span></span>
<span><span class="va">cpca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cPCAplus.html">cPCAplus</a></span><span class="op">(</span>X_f <span class="op">=</span> <span class="va">foreground</span>, X_b <span class="op">=</span> <span class="va">background</span>, ncomp <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using feature-space strategy...</span></span>
<span></span>
<span><span class="co"># Compare what each method finds</span></span>
<span><span class="va">loadings_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>    value   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">regular_pca</span><span class="op">$</span><span class="va">v</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    method  <span class="op">=</span> <span class="st">"Standard PCA"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>    value   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cpca_result</span><span class="op">$</span><span class="va">v</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    method  <span class="op">=</span> <span class="st">"Contrastive PCA"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">loadings_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">feature</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#1f78b4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">method</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Feature"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"|Loading|"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Top loading coefficients for PC1"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="CPCAplus_files/figure-html/motivation_example-1.png" width="576"></p>
<p>Notice how standard PCA focuses on features 1-10 (the common
variation), while contrastive PCA correctly identifies features 20-25
(the group-specific signal).</p>
</div>
<div class="section level2">
<h2 id="using-cpcaplus">Using cPCAplus()<a class="anchor" aria-label="anchor" href="#using-cpcaplus"></a>
</h2>
<p>The <code><a href="../reference/cPCAplus.html">cPCAplus()</a></code> function makes contrastive PCA easy to
use:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basic usage</span></span>
<span><span class="va">cpca_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cPCAplus.html">cPCAplus</a></span><span class="op">(</span></span>
<span>  X_f <span class="op">=</span> <span class="va">foreground</span>,  <span class="co"># Your group of interest (foreground)</span></span>
<span>  X_b <span class="op">=</span> <span class="va">background</span>,  <span class="co"># Your reference group (background)</span></span>
<span>  ncomp <span class="op">=</span> <span class="fl">5</span>          <span class="co"># Number of components to extract</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Using feature-space strategy...</span></span>
<span></span>
<span><span class="co"># The result is a bi_projector object with familiar methods</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cpca_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; A bi_projector object with the following properties:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dimensions of the weights (v) matrix:</span></span>
<span><span class="co">#&gt;   Rows:  50  Columns:  5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dimensions of the scores (s) matrix:</span></span>
<span><span class="co">#&gt;   Rows:  60  Columns:  5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Length of the standard deviations (sdev) vector:</span></span>
<span><span class="co">#&gt;   Length:  5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Preprocessing information:</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">A finalized pre-processing pipeline:</span></span></span>
<span><span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span><span style="color: #BB00BB;"> Step  1 : </span><span style="color: #00BBBB;">center</span></span></span>
<span></span>
<span><span class="co"># Project new data</span></span>
<span><span class="va">new_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">n_features</span><span class="op">)</span>, <span class="fl">10</span>, <span class="va">n_features</span><span class="op">)</span></span>
<span><span class="va">new_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">cpca_fit</span>, <span class="va">new_samples</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reconstruct using top components</span></span>
<span><span class="va">reconstructed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reconstruct.html">reconstruct</a></span><span class="op">(</span><span class="va">cpca_fit</span>, comp <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="understanding-the-output">Understanding the Output<a class="anchor" aria-label="anchor" href="#understanding-the-output"></a>
</h2>
<p><code><a href="../reference/cPCAplus.html">cPCAplus()</a></code> returns a <code>bi_projector</code> object
containing:</p>
<ul>
<li>
<strong><code>v</code></strong>: Loadings (feature weights) for each
component</li>
<li>
<strong><code>s</code></strong>: Scores (sample projections) for the
foreground data</li>
<li>
<strong><code>sdev</code></strong>: Standard deviations explaining
the ‚Äúcontrastive variance‚Äù</li>
<li>
<strong><code>values</code></strong>: The eigenvalue ratios
(foreground variance / background variance)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which features contribute most to the first contrastive component?</span></span>
<span><span class="va">top_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cpca_fit</span><span class="op">$</span><span class="va">v</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Top contributing features:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">top_features</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Top contributing features: 25, 23, 42, 32, 22, 24, 50, 30, 28, 33"</span></span>
<span></span>
<span><span class="co"># How much more variable is each component in foreground vs background?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Variance ratios:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cpca_fit</span><span class="op">$</span><span class="va">values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Variance ratios: 16.74, 13.31, 10.31"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="common-applications">Common Applications<a class="anchor" aria-label="anchor" href="#common-applications"></a>
</h2>
<div class="section level3">
<h3 id="biomedical-studies">1. Biomedical Studies<a class="anchor" aria-label="anchor" href="#biomedical-studies"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify disease-specific patterns</span></span>
<span><span class="va">tumor_cpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cPCAplus.html">cPCAplus</a></span><span class="op">(</span></span>
<span>  X_f <span class="op">=</span> <span class="va">tumor_samples</span>,</span>
<span>  X_b <span class="op">=</span> <span class="va">healthy_tissue</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="technical-variation-removal">2. Technical Variation Removal<a class="anchor" aria-label="anchor" href="#technical-variation-removal"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use technical replicates as background to find biological signal</span></span>
<span><span class="va">bio_cpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cPCAplus.html">cPCAplus</a></span><span class="op">(</span></span>
<span>  X_f <span class="op">=</span> <span class="va">biological_samples</span>,</span>
<span>  X_b <span class="op">=</span> <span class="va">technical_replicates</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="time-based-contrasts">3. Time-Based Contrasts<a class="anchor" aria-label="anchor" href="#time-based-contrasts"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find patterns specific to treatment timepoint</span></span>
<span><span class="va">treatment_cpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cPCAplus.html">cPCAplus</a></span><span class="op">(</span></span>
<span>  X_f <span class="op">=</span> <span class="va">after_treatment</span>,</span>
<span>  X_b <span class="op">=</span> <span class="va">before_treatment</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-options">Advanced Options<a class="anchor" aria-label="anchor" href="#advanced-options"></a>
</h2>
<div class="section level3">
<h3 id="handling-high-dimensional-data">Handling High-Dimensional Data<a class="anchor" aria-label="anchor" href="#handling-high-dimensional-data"></a>
</h3>
<p>When you have more features than samples (p &gt;&gt; n), use the
efficient sample-space strategy:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create high-dimensional example</span></span>
<span><span class="va">n_f</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">n_b</span> <span class="op">&lt;-</span> <span class="fl">80</span>; <span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">X_background_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_b</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n_b</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">X_foreground_hd</span> <span class="op">&lt;-</span> <span class="va">X_background_hd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n_f</span>, <span class="op">]</span> <span class="op">+</span> </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_f</span> <span class="op">*</span> <span class="fl">20</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_f</span> <span class="op">*</span> <span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">n_f</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use sample-space strategy for efficiency</span></span>
<span><span class="va">cpca_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cPCAplus.html">cPCAplus</a></span><span class="op">(</span>X_f <span class="op">=</span> <span class="va">X_foreground_hd</span>, X_b <span class="op">=</span> <span class="va">X_background_hd</span>,</span>
<span>                    ncomp <span class="op">=</span> <span class="fl">5</span>, strategy <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using sample-space strategy...</span></span>
<span><span class="co">#&gt; Warning in irlba::irlba(X_b_centered, nv = r_target, nu = 0): You're computing</span></span>
<span><span class="co">#&gt; too large a percentage of total singular values, use a standard svd instead.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="regularization-for-unstable-background">Regularization for Unstable Background<a class="anchor" aria-label="anchor" href="#regularization-for-unstable-background"></a>
</h3>
<p>If your background covariance is nearly singular, add
regularization:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Small background sample size can lead to instability</span></span>
<span><span class="va">small_background</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">20</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">small_foreground</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">30</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add regularization</span></span>
<span><span class="va">cpca_regularized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cPCAplus.html">cPCAplus</a></span><span class="op">(</span></span>
<span>  X_f <span class="op">=</span> <span class="va">small_foreground</span>,</span>
<span>  X_b <span class="op">=</span> <span class="va">small_background</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.1</span>  <span class="co"># Regularization parameter for background covariance</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Using feature-space strategy...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="when-to-use-contrastive-pca">When to Use Contrastive PCA<a class="anchor" aria-label="anchor" href="#when-to-use-contrastive-pca"></a>
</h2>
<p>‚úì <strong>Use contrastive PCA when:</strong> - You have two groups
and want to find patterns specific to one - Background variation
obscures your signal of interest - You want to remove technical/batch
effects captured by control samples</p>
<p>‚úó <strong>Don‚Äôt use contrastive PCA when:</strong> - You only have
one group (use standard PCA) - Groups differ mainly in mean levels (use
t-tests or LDA) - The interesting variation is non-linear (consider
kernel methods)</p>
</div>
<div class="section level2">
<h2 id="technical-details">Technical Details<a class="anchor" aria-label="anchor" href="#technical-details"></a>
</h2>
<details><summary>
Click for mathematical details
</summary><p>Contrastive PCA++ solves the generalized eigenvalue problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêë</mi><mi>f</mi></msub><mi>ùêØ</mi><mo>=</mo><mi>Œª</mi><msub><mi>ùêë</mi><mi>b</mi></msub><mi>ùêØ</mi></mrow><annotation encoding="application/x-tex">\mathbf{R}_f \mathbf{v} = \lambda \mathbf{R}_b \mathbf{v}</annotation></semantics></math></p>
<p>where: -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêë</mi><mi>f</mi></msub><annotation encoding="application/x-tex">\mathbf{R}_f</annotation></semantics></math>
is the foreground covariance matrix -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêë</mi><mi>b</mi></msub><annotation encoding="application/x-tex">\mathbf{R}_b</annotation></semantics></math>
is the background covariance matrix -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
represents the variance ratio (foreground/background) -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf{v}</annotation></semantics></math>
are the contrastive directions</p>
<p>This finds directions that maximize the ratio of foreground to
background variance, effectively highlighting patterns enriched in the
foreground group.</p>
<p>The <code><a href="../reference/geneig.html">geneig()</a></code> function provides the underlying solver
with multiple algorithm options: - <code>"geigen"</code>: General
purpose, handles non-symmetric matrices - <code>"robust"</code>: Fast
for well-conditioned problems - <code>"primme"</code>: Efficient for
very large sparse matrices</p>
</details>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li>
<code><a href="../reference/pca.html">pca()</a></code> for standard principal component analysis</li>
<li>
<code><a href="../reference/discriminant_projector.html">discriminant_projector()</a></code> for supervised dimensionality
reduction</li>
<li>
<code><a href="../reference/geneig.html">geneig()</a></code> for solving generalized eigenvalue problems
directly</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
