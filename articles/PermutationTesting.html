<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Permutation Testing in multivarious • multivarious</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Permutation Testing in multivarious">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multivarious</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Classifier.html">Classifying in latent space: k-NN &amp; Random-Forest wrappers</a></li>
    <li><a class="dropdown-item" href="../articles/Composing_Projectors.html">Composing Projectors: Chaining Models</a></li>
    <li><a class="dropdown-item" href="../articles/CPCAplus.html">Contrastive PCA: Finding What's Different Between Groups</a></li>
    <li><a class="dropdown-item" href="../articles/CrossValidation.html">Cross-validation for Dimensionality Reduction</a></li>
    <li><a class="dropdown-item" href="../articles/Extending.html">Extending multiblock: CCA and glmnet Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction.html">Introduction to the multivarious Package</a></li>
    <li><a class="dropdown-item" href="../articles/Multiblock.html">Multiblock basics: one projector, many tables</a></li>
    <li><a class="dropdown-item" href="../articles/Nystrom.html">Kernel PCA Made Fast: The Nyström Approximation</a></li>
    <li><a class="dropdown-item" href="../articles/Partial_Projection.html">Partial projection: working with incomplete feature sets</a></li>
    <li><a class="dropdown-item" href="../articles/PermutationTesting.html">Permutation Testing in multivarious</a></li>
    <li><a class="dropdown-item" href="../articles/PreProcessing.html">Pre-processing pipelines in multiblock</a></li>
    <li><a class="dropdown-item" href="../articles/Regress.html">Linear Re-representation with regress()</a></li>
    <li><a class="dropdown-item" href="../articles/SVD_PCA.html">SVD wrapper, PCA and the bi_projector</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Permutation Testing in multivarious</h1>
            
      

      <div class="d-none name"><code>PermutationTesting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-permutation-tests">1. Why Permutation Tests?<a class="anchor" aria-label="anchor" href="#why-permutation-tests"></a>
</h2>
<p>Many dimensionality reduction techniques involve selecting the number
of components to retain (e.g., in PCA or PLS) or assessing the overall
significance of the model (e.g., is the relationship found by CCA
stronger than chance?). Classical heuristics like scree plots or
variance explained thresholds are useful but lack a formal statistical
basis for hypothesis testing.</p>
<p>Permutation testing provides a non-parametric way to assess
statistical significance by building an empirical null distribution from
the data itself. The core idea is:</p>
<ol style="list-style-type: decimal">
<li>Calculate the statistic of interest on the original data (e.g.,
variance explained by PC1, classification accuracy, canonical
correlation).</li>
<li>Repeat many times:
<ol style="list-style-type: lower-alpha">
<li>
<strong>Shuffle</strong> the data in a way that breaks the
relationship being tested (e.g., shuffle column values independently for
PCA, shuffle class labels for discriminant analysis, shuffle rows of one
block for CCA/PLS).</li>
<li>
<strong>Re-fit</strong> the model or <strong>re-calculate</strong>
the statistic on the shuffled data.</li>
</ol>
</li>
<li>Compare the originally observed statistic to the distribution of
statistics obtained from the shuffled data. If the observed value is
extreme relative to the permutation distribution, it suggests the
observed structure is unlikely to have arisen by chance.</li>
</ol>
<p>The <code>multivarious</code> package provides a generic function
<code><a href="../reference/perm_test.html">perm_test()</a></code> with methods for various model types to
streamline this process.</p>
<hr>
</div>
<div class="section level2">
<h2 id="generic-workflow">2. Generic Workflow<a class="anchor" aria-label="anchor" href="#generic-workflow"></a>
</h2>
<p>The basic workflow involves fitting your model and then passing it,
along with the original data, to <code><a href="../reference/perm_test.html">perm_test()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Fit the model of interest (e.g., PCA)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">X_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Center the data before PCA</span></span>
<span><span class="va">preproc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/center.html">center</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Fit PCA (ensure enough components for testing)</span></span>
<span><span class="va">mod_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca.html">pca</a></span><span class="op">(</span><span class="va">X_iris</span>, ncomp <span class="op">=</span> <span class="fl">4</span>, preproc <span class="op">=</span> <span class="va">preproc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Call perm_test()</span></span>
<span><span class="co">#    It dispatches based on the class of 'mod_pca' (here, 'pca').</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># for reproducibility</span></span>
<span><span class="va">pt_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perm_test.html">perm_test</a></span><span class="op">(</span><span class="va">mod_pca</span>, X <span class="op">=</span> <span class="va">X_iris</span>,        <span class="co"># Original data matrix is often needed</span></span>
<span>                    nperm <span class="op">=</span> <span class="fl">199</span>,               <span class="co"># Number of permutations (use more in practice, e.g., 999)</span></span>
<span>                    comps <span class="op">=</span> <span class="fl">3</span>,                 <span class="co"># Test up to 3 components sequentially</span></span>
<span>                    parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>          <span class="co"># Set TRUE to use future backend</span></span>
<span></span>
<span><span class="co"># 3. Inspect the results</span></span>
<span><span class="co"># The result object contains detailed information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pt_pca</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; PCA Permutation Test Results</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method:  Permutation test for PCA (Vitale et al. 2017 P3) (statistic: F_a (Fraction of Remaining Variance), stepwise: TRUE, shuffle: column-wise) </span></span>
<span><span class="co">#&gt; Alternative:  greater </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Component Results:</span></span>
<span><span class="co">#&gt;   comp  observed  pval  lower_ci  upper_ci</span></span>
<span><span class="co">#&gt; 1    1 0.9246187 0.005 0.6816137 0.6893677</span></span>
<span><span class="co">#&gt; 2    2 0.7039743 0.010 0.6086950 0.6890558</span></span>
<span><span class="co">#&gt; 3    3 0.7664247 0.055 0.6676700 0.7849276</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of successful permutations per component: 199, 199, 199</span></span>
<span></span>
<span><span class="co"># Access the results table directly</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pt_pca</span><span class="op">$</span><span class="va">component_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;    comp observed  pval lower_ci upper_ci</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1    0.925 0.005    0.682    0.689</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2    0.704 0.01     0.609    0.689</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3    0.766 0.055    0.668    0.785</span></span>
<span></span>
<span><span class="co"># plot() method shows observed statistic vs. permutation distribution (if applicable)</span></span>
<span><span class="co"># plot(pt_pca) # Plot method might need specific implementation or data structure</span></span></code></pre></div>
<div class="section level3">
<h3 id="method-specific-defaults">Method-Specific Defaults<a class="anchor" aria-label="anchor" href="#method-specific-defaults"></a>
</h3>
<p>The <code>perm_test</code> function behaves differently depending on
the class of the fitted model object. Here’s a summary of the defaults
for common model types:</p>
<table class="table">
<colgroup>
<col width="16%">
<col width="29%">
<col width="32%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th>Model Class</th>
<th>Default Statistic (per-component/overall)</th>
<th>Default Shuffle Method</th>
<th>Purpose / Key Reference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>pca</code></td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>a</mi></msub><mo>=</mo><mfrac><msub><mi>λ</mi><mi>a</mi></msub><mrow><msub><mo>∑</mo><mrow><mi>j</mi><mo>≥</mo><mi>a</mi></mrow></msub><msub><mi>λ</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">F_a = \frac{\lambda_a}{\sum_{j \ge a}\lambda_j}</annotation></semantics></math>
(Frac. Remain. Var.)</td>
<td>Column-wise permutation of centered data (P³)</td>
<td>Test PC significance (Vitale 2017)</td>
</tr>
<tr class="even">
<td><code>multiblock_biprojector</code></td>
<td>Leading eigenvalue of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>T</mi><mi>k</mi><mi>T</mi></msubsup><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">T_k^T T_k</annotation></semantics></math>
</td>
<td>Independent row shuffles within each block (scores/Xlist)</td>
<td>Test consensus / block structure</td>
</tr>
<tr class="odd">
<td><code>multiblock_projector</code></td>
<td>Mean absolute correlation between block scores</td>
<td>Independent row shuffles within each block (Xlist)</td>
<td>Test consensus / block structure</td>
</tr>
<tr class="even">
<td><code>cross_projector</code></td>
<td>MSE of transferring X → Y (<code>x2y.mse</code>)</td>
<td>Row permutation of Y block only</td>
<td>Test X-Y relationship significance</td>
</tr>
<tr class="odd">
<td><code>discriminant_projector</code></td>
<td>Overall classification accuracy (LDA/Euclid)</td>
<td>Row permutation of class labels</td>
<td>Test class separation significance</td>
</tr>
</tbody>
</table>
<p><strong>Sequential Stopping (PCA &amp; Multiblock Methods):</strong>
By default (<code>alpha = 0.05</code>), testing stops sequentially once
a component is found to be non-significant (p-value &gt; alpha). Set
<code>alpha = 1</code> to force testing of all requested components
specified by the <code>comps</code> argument.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="customising-the-engine">3. Customising the Engine<a class="anchor" aria-label="anchor" href="#customising-the-engine"></a>
</h2>
<p>You can override the default behavior by providing custom functions
for shuffling, fitting (for some methods), or measuring the
statistic.</p>
<ul>
<li>
<code>measure_fun(model_perm, ...)</code>: Calculates the statistic
of interest from a model fitted on permuted data. Should typically
return a single numeric value (or a vector of values if testing multiple
components simultaneously, though sequential testing is more
common).</li>
<li>
<code>shuffle_fun(data, ...)</code>: Permutes the relevant part of
the data (e.g., labels, a specific block, columns). Must preserve the
data structure expected by the fitting/measuring function.</li>
<li>
<code>fit_fun(Xtrain, ...)</code>: (Used by
<code>cross_projector</code>, <code>discriminant_projector</code>)
Re-fits the model on permuted data. Required if the default fitting
(e.g., <code><a href="https://rdrr.io/r/stats/cancor.html" class="external-link">stats::cancor</a></code>, <code><a href="https://rdrr.io/pkg/MASS/man/lda.html" class="external-link">MASS::lda</a></code>) is not
suitable.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Custom statistic for PCA - total variance explained by first TWO PCs</span></span>
<span><span class="va">my_pca_stat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_perm</span>, <span class="va">comp_idx</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># This function is called sequentially for each component 'comp_idx' by perm_test.pca</span></span>
<span>  <span class="co"># To get total variance for first 2, we calculate it only when comp_idx=2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">comp_idx</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_perm</span><span class="op">$</span><span class="va">sdev</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">model_perm</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">model_perm</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">comp_idx</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_perm</span><span class="op">$</span><span class="va">sdev</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="co"># Need to return something for comp 1, e.g., variance of PC1</span></span>
<span>     <span class="va">model_perm</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">model_perm</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>     <span class="cn">NA_real_</span> <span class="co"># Return NA if component doesn't exist or doesn't match target</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Note: The default sequential testing expects one stat per component.</span></span>
<span><span class="co"># To test a single combined statistic, you might set comps=1 and have</span></span>
<span><span class="co"># measure_fun calculate the combined stat regardless of comp_idx.</span></span>
<span><span class="co"># Or, analyze pt_pca$perm_values manually after running with default measure.</span></span>
<span></span>
<span><span class="co"># Example call (illustrative - using default measure for simplicity here)</span></span>
<span><span class="va">pt_pca_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perm_test.html">perm_test</a></span><span class="op">(</span><span class="va">mod_pca</span>, X <span class="op">=</span> <span class="va">X_iris</span>, nperm <span class="op">=</span> <span class="fl">50</span>, comps <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                         <span class="co"># measure_fun = my_pca_stat, # Uncomment to use custom stat</span></span>
<span>                         parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Pre-calculating reconstructions for stepwise testing...</span></span>
<span><span class="co">#&gt; Running 50 permutations sequentially for up to 2 PCA components (alpha=0.050, serial)...</span></span>
<span><span class="co">#&gt;   Testing Component 1/2...</span></span>
<span><span class="co">#&gt;   Testing Component 2/2...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pt_pca_custom</span><span class="op">$</span><span class="va">component_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;    comp observed   pval lower_ci upper_ci</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1    0.925 0.019<span style="text-decoration: underline;">6</span>    0.682    0.692</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2    0.704 0.019<span style="text-decoration: underline;">6</span>    0.619    0.690</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="parallelisation">4. Parallelisation<a class="anchor" aria-label="anchor" href="#parallelisation"></a>
</h2>
<p>Permutation tests can be computationally intensive.
<code>perm_test</code> methods leverage the <code>future</code> and
<code>future.apply</code> packages for parallel execution. To enable
parallelism:</p>
<ol style="list-style-type: decimal">
<li>Load the <code>future</code> package.</li>
<li>Choose a parallel plan (e.g., <code>multisession</code> for
background R processes).</li>
<li>Set <code>parallel = TRUE</code> in the <code>perm_test</code>
call.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># Use 4 background R sessions</span></span>
<span></span>
<span><span class="va">pt_pca_parallel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perm_test.html">perm_test</a></span><span class="op">(</span><span class="va">mod_pca</span>, X <span class="op">=</span> <span class="va">X_iris</span>, nperm <span class="op">=</span> <span class="fl">499</span>, comps <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Always good practice to revert plan when done, e.g.:</span></span>
<span><span class="co"># plan(sequential)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="caveats-tips">5. Caveats &amp; Tips<a class="anchor" aria-label="anchor" href="#caveats-tips"></a>
</h2>
<table class="table">
<colgroup>
<col width="32%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th>Situation</th>
<th>Recommendation / What to Do</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Very high-dimensional data (p &gt;&gt; n)</td>
<td>For PCA, consider <code>use_svd_solver = "RSpectra"</code> if
installed. Keep <code>comps</code> reasonably small.</td>
</tr>
<tr class="even">
<td>Non-exchangeable structure (time-series, spatial, blocks)</td>
<td>Default shuffling might be invalid. Provide a custom
<code>shuffle_fun</code> that respects dependencies.</td>
</tr>
<tr class="odd">
<td>Confidence Intervals for statistic?</td>
<td>The <code>component_results</code> table includes empirical 95% CIs
derived from the permutation distribution.</td>
</tr>
<tr class="even">
<td>Slow performance</td>
<td>Increase <code>nperm</code> gradually. Use
<code>parallel = TRUE</code>. Profile custom functions if used.</td>
</tr>
<tr class="odd">
<td>Need original data (<code>X</code>, <code>Y</code>,
<code>Xlist</code>)?</td>
<td>Yes, most methods require the original data to perform permutations
or re-fitting correctly.</td>
</tr>
<tr class="even">
<td>Deprecated <code>perm_ci.pca()</code>
</td>
<td>Use <code><a href="../reference/perm_test.html">perm_test.pca()</a></code>. The CI is included in the results
table.</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="internal-checks-developer-focus">6. Internal Checks (Developer Focus)<a class="anchor" aria-label="anchor" href="#internal-checks-developer-focus"></a>
</h2>
<p>This chunk runs brief checks mainly for package development and
continuous integration (CI) testing. It uses a small <code>nperm</code>
for speed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Running internal checks for perm_test methods..."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running internal checks for perm_test methods...</span></span>
<span></span>
<span><span class="co"># PCA Check</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">mtcars_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pca_test_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca.html">pca</a></span><span class="op">(</span><span class="va">mtcars_mat</span>, ncomp <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">pt_check_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perm_test.html">perm_test</a></span><span class="op">(</span><span class="va">pca_test_mod</span>, <span class="va">mtcars_mat</span>, nperm <span class="op">=</span> <span class="fl">19</span>, comps<span class="op">=</span><span class="fl">2</span>, parallel<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Pre-calculating reconstructions for stepwise testing...</span></span>
<span><span class="co">#&gt; Running 19 permutations sequentially for up to 2 PCA components (alpha=0.050, serial)...</span></span>
<span><span class="co">#&gt;   Testing Component 1/2...</span></span>
<span><span class="co">#&gt;   Testing Component 2/2...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pt_check_pca</span><span class="op">$</span><span class="va">component_results</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>,</span>
<span>          <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pt_check_pca</span><span class="op">$</span><span class="va">component_results</span><span class="op">$</span><span class="va">pval</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Multiblock Check (requires a multiblock model)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co"># Example assumes mb_pca exists and works</span></span>
<span>  <span class="co"># mb_test_mod &lt;- mb_pca(list(a = USArrests[,1:2], b = USArrests[,3:4]), ncomp = 2)</span></span>
<span>  <span class="co"># pt_check_mb &lt;- perm_test(mb_test_mod, nperm = 9, comps=1, parallel=FALSE)</span></span>
<span>  <span class="co"># stopifnot(nrow(pt_check_mb$component_results) == 1)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Multiblock perm_test check skipped (requires mb_pca example)."</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Multiblock perm_test check failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Multiblock perm_test check skipped (requires mb_pca example).</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Internal checks for perm_test finished."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Internal checks for perm_test finished.</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="references">7. References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Vitale, R., Westerhuis, J. A., Næs, T., Smilde, A. K., de Noord, O.
E., &amp; Ferrer, A. (2017). Selecting the number of factors in
principal component analysis by permutation testing— Numerical and
practical aspects. <em>Journal of Chemometrics</em>, 31(10), e2937.
</li>
<li>Good, P. I. (2005). <em>Permutation, Parametric, and Bootstrap Tests
of Hypotheses</em>. Springer Series in Statistics. Springer.</li>
<li>Bengtsson, H. (2021). future: Unified Parallel and Distributed
Processing in R for Everyone. <em>R package version 1.21.0</em>. <a href="https://future.futureverse.org/" class="external-link uri">https://future.futureverse.org/</a>
</li>
</ul>
<hr>
<p>By providing a unified <code>perm_test</code> interface,
<code>multivarious</code> allows researchers to apply robust,
data-driven significance testing across a range of multivariate modeling
techniques.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
